---
import { getCollection, render } from "astro:content";
import { getRelativeLocaleUrl } from "astro:i18n";
import BlogPostCard from "../../components/blog/BlogPostCard.astro";
import IconPhNewspaperDuotone from "../../components/icons/PhNewspaperDuotone.astro";
import MainLayout from "../../layouts/MainLayout.astro";

// Fetch all blog posts with read time
const blogPosts = await getCollection("blogEnCollection").then(async (posts) => {
  const postsWithReadTime = await Promise.all(
    posts.map(async (post) => {
      const { remarkPluginFrontmatter } = await render(post);
      return {
        ...post,
        data: {
          ...post.data,
          readTime: Math.ceil(remarkPluginFrontmatter.readingTime),
        },
      };
    })
  );

  return postsWithReadTime.sort((a, b) => {
    // Featured posts first
    if (a.data.featured && !b.data.featured) return -1;
    if (!a.data.featured && b.data.featured) return 1;
    // Then sort by date
    return new Date(b.data.publishedDate).getTime() - new Date(a.data.publishedDate).getTime();
  });
});
---

<MainLayout
  title="Blog"
  description="Visit the HallinMedia blog for engaging articles on technology and personal stories in English and Swedish. Join the conversation!"
>
  <main class="flex flex-col gap-12 font-serif selection:bg-red-300 selection:text-red-800">
    <header class="flex flex-col-reverse justify-between gap-4 sm:flex-row sm:items-center">
      <h1 class="max-w-md text-4xl font-light break-words text-stone-900 italic">My "newspaper"</h1>
      <IconPhNewspaperDuotone
        class="motion-preset-expand h-8 w-8 text-red-500 sm:h-12 sm:w-12"
        aria-hidden="true"
      />
    </header>
    <article class="flex flex-col gap-4 text-sm font-light text-stone-700">
      <p>
        My blog, or as I like to call it, my newspaper, is a place for all my various publications.
        It includes everything from my experiences and discoveries to personal opinions and things
        I'd like to share. Most of my posts are quite short and to the point, though some might be
        more complex and elaborate.
      </p>
      <p>
        Feel free to see if any title piques your interestâ€”remember, all blog posts are available in
        both <a
          href={getRelativeLocaleUrl("en", "blog")}
          class="text-blue-500 underline decoration-dashed decoration-from-font underline-offset-4 hover:bg-blue-500 hover:text-stone-50 hover:no-underline active:opacity-50"
          aria-label="English version of the blog">English</a
        > and <a
          href={getRelativeLocaleUrl("sv", "blog")}
          class="text-amber-500 underline decoration-dashed decoration-from-font underline-offset-4 hover:bg-amber-500 hover:text-stone-50 hover:no-underline active:opacity-50"
          aria-label="Swedish version of the blog">Swedish</a
        > and have support for commenting (as long as you have a <a
          href="https://github.com/"
          target="_blank"
          data-umami-event="blog_github"
          data-umami-event-url="https://github.com/"
          data-umami-event-origin={Astro.url}
          class="text-red-500 underline decoration-dashed decoration-from-font underline-offset-4 hover:bg-red-500 hover:text-stone-50 hover:no-underline active:opacity-50"
          aria-label="GitHub (opens in new tab)"
          rel="noopener noreferrer">GitHub</a
        > account).
      </p>
    </article>

    <div class="grid gap-4 sm:grid-cols-2" role="list">
      {blogPosts.map((post) => <BlogPostCard post={post} role="listitem" />)}
    </div>
  </main>
</MainLayout>

---
import { getCollection, render } from "astro:content";
import { getRelativeLocaleUrl } from "astro:i18n";
import BlogPostCard from "../../../components/blog/BlogPostCard.astro";
import IconPhNewspaperDuotone from "../../../components/icons/PhNewspaperDuotone.astro";
import MainLayout from "../../../layouts/MainLayout.astro";

// Fetch all blog posts with read time
const blogPosts = await getCollection("blogSvCollection").then(async (posts) => {
  const postsWithReadTime = await Promise.all(
    posts.map(async (post) => {
      const { remarkPluginFrontmatter } = await render(post);
      return {
        ...post,
        data: {
          ...post.data,
          readTime: Math.ceil(remarkPluginFrontmatter.readingTime),
        },
      };
    })
  );

  return postsWithReadTime.sort((a, b) => {
    // Featured posts first
    if (a.data.featured && !b.data.featured) return -1;
    if (!a.data.featured && b.data.featured) return 1;
    // Then sort by date
    return new Date(b.data.publishedDate).getTime() - new Date(a.data.publishedDate).getTime();
  });
});
---

<MainLayout
  title="Blogg"
  description="Besök William Hallins blogg för artiklar om teknik och personliga berättelser på engelska och svenska. Delta i diskussionen!"
>
  <main class="flex flex-col gap-12 font-serif selection:bg-red-300 selection:text-red-800">
    <header class="flex flex-col-reverse justify-between gap-4 sm:flex-row sm:items-center">
      <h1 class="max-w-md text-4xl font-light break-words text-stone-900 italic">Min "tidning"</h1>
      <IconPhNewspaperDuotone class="motion-preset-expand h-8 w-8 text-red-500 sm:h-12 sm:w-12" />
    </header>
    <article class="flex flex-col gap-4 text-sm font-light text-stone-700">
      <p>
        Min blogg, eller som jag brukar kalla den, min tidning, är en plats för alla mina olika
        publikationer. Den innehåller allt från mina erfarenheter och upptäckter till personliga
        åsikter och sådant jag vill dela med mig av. De flesta av mina inlägg är ganska korta och
        koncisa, men vissa kan vara mer komplexa och utförliga.
      </p>
      <p>
        Titta gärna om någon titel väcker ditt intresse - kom ihåg att alla blogginlägg finns
        tillgängliga på både <a
          href={getRelativeLocaleUrl("en", "blog")}
          class="text-blue-500 underline decoration-dashed decoration-from-font underline-offset-4 hover:bg-blue-500 hover:text-stone-50 hover:no-underline active:opacity-50"
          >engelska</a
        > och <a
          href={getRelativeLocaleUrl("sv", "blog")}
          class="text-amber-500 underline decoration-dashed decoration-from-font underline-offset-4 hover:bg-amber-500 hover:text-stone-50 hover:no-underline active:opacity-50"
          >svenska</a
        > och har stöd för kommentarer (så länge du har ett <a
          href="https://github.com/"
          target="_blank"
          data-umami-event="blog_github"
          data-umami-event-url="https://github.com/"
          data-umami-event-origin={Astro.url}
          class="text-red-500 underline decoration-dashed decoration-from-font underline-offset-4 hover:bg-red-500 hover:text-stone-50 hover:no-underline active:opacity-50"
          >Github-konto</a
        >).
      </p>
    </article>

    <div class="grid gap-4 sm:grid-cols-2">
      {blogPosts.map((post) => <BlogPostCard post={post} />)}
    </div>
  </main>
</MainLayout>

---
import { Picture } from "astro:assets";
import { getCollection, render, type CollectionEntry } from "astro:content";
import { getRelativeLocaleUrl } from "astro:i18n";
import BlogHeader from "../../../components/blog/BlogHeader.astro";
import BlogMeta from "../../../components/blog/BlogMeta.astro";
import RelatedPosts from "../../../components/blog/RelatedPosts.astro";
import CtaBanner from "../../../components/sections/CtaBanner.astro";
import MainLayout from "../../../layouts/MainLayout.astro";

export async function getStaticPaths() {
  const blogPosts = await getCollection("blogSvCollection");
  return blogPosts.map((post) => ({
    params: { slug: post.id },
    props: { post, allPosts: blogPosts },
  }));
}

type Props = {
  post: CollectionEntry<"blogSvCollection">;
  allPosts: CollectionEntry<"blogSvCollection">[];
};

const { post, allPosts } = Astro.props;
const { Content, remarkPluginFrontmatter } = await render(post);
const categoryColor = {
  Design: "sky",
  Fotografi: "fuchsia",
  Video: "rose",
  Marknadsföring: "emerald",
  Teknik: "amber",
  Företagande: "indigo",
  Guider: "pink",
  Insikter: "teal",
}[post.data.category];
---

<MainLayout
  title={post.data.title}
  description={post.data.description}
  article={true}
  datePublished={post.data.publishedDate}
  dateModified={post.data.updatedDate}
>
  <wbr
    class="hidden hover:border-amber-500 hover:border-emerald-500 hover:border-fuchsia-500 hover:border-indigo-500 hover:border-pink-500 hover:border-rose-500 hover:border-sky-500 hover:border-teal-500 hover:text-amber-700 hover:text-emerald-700 hover:text-fuchsia-700 hover:text-indigo-700 hover:text-pink-700 hover:text-rose-700 hover:text-sky-700 hover:text-teal-700"
  />
  <article class="flex flex-col gap-8 font-serif">
    <BlogHeader
      category={post.data.category}
      title={post.data.title}
      categoryColor={categoryColor}
    />

    {
      post.data.featuredImage && (
        <Picture
          src={post.data.featuredImage}
          alt={post.data.featuredImageAlt}
          widths={[320, 480, 768]}
          formats={["avif", "webp", "jpeg"]}
          sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
          class={`hover:border-${categoryColor}-500 aspect-video w-full rounded-lg border-2 border-stone-300 object-cover transition duration-200 select-none hover:-translate-y-1 hover:drop-shadow-lg`}
        />
      )
    }

    <BlogMeta
      publishedDate={post.data.publishedDate}
      updatedDate={post.data.updatedDate}
      author={post.data.author}
      readingTime={Math.ceil(remarkPluginFrontmatter.readingTime)}
      tags={post.data.tags}
      categoryColor={categoryColor}
    />

    <section
      class="prose prose-stone my-8 max-w-none text-sm font-light text-stone-700 selection:bg-red-300 selection:text-red-800"
    >
      <Content />
    </section>

    <hr class="border-stone-300" />

    {
      post.data.relatedPosts && post.data.relatedPosts.length > 0 && (
        <RelatedPosts
          relatedPosts={post.data.relatedPosts}
          allPosts={allPosts}
          categoryColor={categoryColor}
          currentLocale={Astro.currentLocale}
        />
      )
    }

    <CtaBanner
      title="Gillade du detta inlägg?"
      description={`Om du tyckte att den här artikeln var användbar eller intressant, dela den gärna med andra som kan ha nytta av den. Du kan också läsa mer innehåll från kategorin ${post.data.category}.`}
      buttonText={`Mer ${post.data.category} inlägg`}
      pricingText="Dela på LinkedIn"
      contactLink={getRelativeLocaleUrl(
        `${Astro.currentLocale}`,
        `/blog?category=${post.data.category.toLowerCase()}`
      )}
      pricingLink={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}`}
    />
  </article>
</MainLayout>

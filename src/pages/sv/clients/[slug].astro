---
import { getCollection } from "astro:content";
import ClientAbout from "../../../components/clients/ClientAbout.astro";
import ClientHeader from "../../../components/clients/ClientHeader.astro";
import ClientNotice from "../../../components/clients/ClientNotice.astro";
import ClientPortfolio from "../../../components/clients/ClientPortfolio.astro";
import ClientSocialLinks from "../../../components/clients/ClientSocialLinks.astro";
import CtaBanner from "../../../components/sections/CtaBanner.astro";
import MainLayout from "../../../layouts/MainLayout.astro";

export async function getStaticPaths() {
  const clients = await getCollection("clientsCollection");
  return clients.map((client) => ({
    params: { slug: client.id },
    props: { client },
  }));
}

const { client } = Astro.props;
const { data } = client;
const dominantColor = data.dominantColor || "oklch(0.637 0.237 25.331)";

const portfolioPosts = await getCollection("portfolioSvCollection").then((posts) =>
  posts
    .filter((post) => post.data.client.id === client.id)
    .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
);
---

<MainLayout title={data.name} description={data.description.sv}>
  <main class="flex flex-col gap-12 font-serif" style={`--dominant-color: ${dominantColor}`}>
    <ClientHeader logo={data.logo} name={data.name} dominantColor={dominantColor} />

    {data.subcontracted && <ClientNotice dominantColor={dominantColor} />}

    <div class="flex flex-col gap-8">
      <ClientAbout
        clientId={client.id}
        name={data.name}
        description={data.description.sv}
        websiteUrl={data.websiteUrl}
        dominantColor={dominantColor}
      >
        {
          data.socialLinks && (
            <ClientSocialLinks clientId={client.id} socialLinks={data.socialLinks} />
          )
        }
      </ClientAbout>
    </div>

    {
      portfolioPosts.length > 0 && (
        <ClientPortfolio
          posts={portfolioPosts}
          dominantColor={dominantColor}
          currentLocale={Astro.currentLocale}
        />
      )
    }

    <CtaBanner
      title="Redo att börja samarbeta?"
      description=`${data.name} är nöjda med vårt samarbete. Vad hindrar oss från att bli nästa samarbetsduo? Låt oss börja diskutera dina idéer och projekt för att se vad vi kan skapa tillsammans!`
      buttonText="Skicka ett meddelande"
      pricingText="Se priser"
    />
  </main>
</MainLayout>

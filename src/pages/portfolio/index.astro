---
import { getCollection, getEntry } from "astro:content";
import IconPhSparkleDuotone from "../../components/icons/PhSparkleDuotone.astro";
import PortfolioCard from "../../components/portfolio/PortfolioCard.astro";
import MainLayout from "../../layouts/MainLayout.astro";

// Fetch all portfolio posts
const portfolioPosts = await getCollection("portfolioEnCollection").then((posts) =>
  posts.sort((a, b) => {
    // Featured posts first
    if (a.data.featured && !b.data.featured) return -1;
    if (!a.data.featured && b.data.featured) return 1;
    // Then sort by date
    return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
  })
);
---

<MainLayout
  title="Portfolio"
  description="Visit my portfolio page to see where creativity and innovation meet. Explore a selection of my best projects, showing my skills and development."
>
  <main class="space-y-12 font-serif">
    <header class="selection:bg-red-300 selection:text-red-800">
      <div class="flex flex-col-reverse justify-between gap-4 sm:flex-row sm:items-center">
        <h1 class="max-w-md text-4xl font-light break-words text-stone-900 italic">
          Previous works
        </h1>
        <IconPhSparkleDuotone
          class="motion-opacity-loop-60 motion-duration-2000 motion-ease h-8 w-8 text-red-500 sm:h-12 sm:w-12"
        />
      </div>
    </header>

    <article class="selection:bg-red-300 selection:text-red-800">
      <div class="flex flex-col gap-4 text-sm font-light text-stone-700">
        <p>
          What is a portfolio website without a portfolio page? This page highlights my best and
          most interesting work and creations. Some may be better than others, especially compared
          to older crafts, but that's part of growing and learning.
        </p>
      </div>
    </article>

    <div class="grid gap-4 sm:grid-cols-2">
      {
        portfolioPosts.map(async (post) => {
          const client = await getEntry("clientsCollection", post.data.client.id);
          return <PortfolioCard post={post} client={client} currentLocale={Astro.currentLocale} />;
        })
      }
    </div>
  </main>
</MainLayout>

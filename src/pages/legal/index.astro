---
import { getCollection } from "astro:content";
import IconPhGavelDuotone from "../../components/icons/PhGavelDuotone.astro";
import LegalCategorySection from "../../components/legal/LegalCategorySection.astro";
import MainLayout from "../../layouts/MainLayout.astro";

const allLegalDocs = (await getCollection("legalEnCollection")).sort(
  (a, b) => new Date(b.data.publishedDate).getTime() - new Date(a.data.publishedDate).getTime()
);

const groupedDocs = allLegalDocs.reduce((acc: Record<string, typeof allLegalDocs>, doc) => {
  const category = doc.data.documentType;
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(doc);
  return acc;
}, {});
---

<MainLayout
  title="Legal"
  description="Explore the legal directory for crucial documents and policies for smooth transactions. Find guidelines on publishing, copyright, GDPR, and DMCA compliance."
>
  <main class="font-serif selection:bg-red-300 selection:text-red-800">
    <header class="flex flex-col-reverse justify-between gap-4 sm:flex-row sm:items-center">
      <h1 class="max-w-md text-4xl font-light text-stone-900 italic">Legalities</h1>
      <IconPhGavelDuotone
        class="-motion-rotate-loop-16 flip motion-ease motion-duration-2000 h-8 w-8 origin-bottom-left text-red-500 sm:h-12 sm:w-12"
      />
    </header>
    <article class="mt-12 flex flex-col gap-4 text-sm font-light text-stone-700">
      <p>
        Sometimes, paperwork, especially legal documents, can get in the way of fun. I make sure all
        the necessary documents and conditions are ready for you and your business when we work
        together. You're more than welcome to look around and see what terms and policies are
        available for you.
      </p>
      <p>
        If you have any questions about my legal documents, feel free to <a
          href="mailto:william@hallin.media?subject=A legal question..."
          data-umami-event="legal_email-question"
          data-umami-event-origin={Astro.url}
          class="text-red-500 underline decoration-dashed decoration-from-font underline-offset-4 hover:bg-red-500 hover:text-stone-50 hover:no-underline active:opacity-50"
          >email me</a
        >.
      </p>

      <div class="mt-6 space-y-8">
        {
          Object.entries(groupedDocs).map(([category, docs]) => (
            <LegalCategorySection category={category} docs={docs} />
          ))
        }
      </div>
    </article>
  </main>
</MainLayout>

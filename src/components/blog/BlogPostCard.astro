---
import { Picture } from "astro:assets";
import { getRelativeLocaleUrl } from "astro:i18n";

const translations = {
  en: {
    minutes_read: "min read",
    read_more: "Read more",
    featured_post: "Featured post",
    category_label: "Category:",
    published_date: "Published date:",
  },
  sv: {
    minutes_read: "min att läsa",
    read_more: "Läs mer",
    featured_post: "Utvalt inlägg",
    category_label: "Kategori:",
    published_date: "Publiceringsdatum:",
  },
};

const { post } = Astro.props;
---

<a
  href={getRelativeLocaleUrl(`${Astro.currentLocale}`, `/blog/${post.id}`)}
  class="group block h-full transition active:scale-95"
  aria-labelledby={`post-title-${post.id}`}
>
  <article
    class="relative flex h-full flex-col overflow-hidden rounded-lg border border-stone-300 bg-amber-50 transition selection:bg-red-300 selection:text-red-800 hover:-translate-y-1 hover:border-red-500 hover:drop-shadow-[0_4px_4px_rgb(0,0,0,0.05)] active:-translate-y-1 active:border-red-500 active:drop-shadow-[0_4px_4px_rgb(0,0,0,0.05)]"
    role="article"
  >
    {
      post.data.featured && (
        <mark
          class="absolute top-4 right-4 z-10 bg-transparent text-xl text-red-500 select-none"
          aria-label={translations[Astro.currentLocale].featured_post}
        >
          ★
        </mark>
      )
    }
    <figure class="relative overflow-hidden" role="group">
      <span
        class="absolute top-4 left-4 z-10 rounded-full border border-stone-500 bg-amber-50 px-2 py-1 text-xs font-light text-stone-700 transition group-hover:border-red-500 group-hover:text-red-700 group-active:border-red-500 group-active:text-red-700"
        aria-label={`${translations[Astro.currentLocale].category_label} ${post.data.category}`}
      >
        {post.data.category}
      </span>
      <Picture
        src={post.data.featuredImage}
        alt={post.data.featuredImageAlt}
        widths={[320, 480, 640, 768, 1024]}
        sizes="(max-width: 640px) 100vw, (max-width: 768px) 50vw, (max-width: 1024px) 25vw"
        class="h-48 w-full bg-stone-300 object-cover transition select-none group-hover:scale-105 group-active:scale-105"
        formats={["avif", "webp", "jpeg"]}
      />
    </figure>
    <section class="flex flex-1 flex-col p-4">
      <header>
        <h2
          class="mb-2 font-serif text-xl text-stone-900 italic underline decoration-dashed decoration-from-font underline-offset-4 group-hover:text-red-500 group-active:text-red-500"
          id={`post-title-${post.id}`}
        >
          {post.data.title}
        </h2>
      </header>
      <p class="line-clamp-2 text-sm font-light text-stone-600">
        {post.data.description}
      </p>
    </section>
    <footer
      class="mt-auto flex flex-row flex-wrap items-center justify-between border-t border-stone-200 p-4 text-stone-500"
    >
      <div class="flex flex-col gap-1">
        <time
          class="font-mono text-sm font-light text-stone-500"
          datetime={new Date(post.data.publishedDate).toISOString()}
          aria-label={`${translations[Astro.currentLocale].published_date} ${new Date(post.data.publishedDate).toLocaleDateString()}`}
        >
          {new Date(post.data.publishedDate).toLocaleDateString()}
        </time>
        <small class="font-mono text-xs font-light text-stone-400">
          {post.data.readTime}
          {translations[Astro.currentLocale].minutes_read}
        </small>
      </div>
      <div
        class="flex items-center justify-end gap-2 group-hover:text-red-500 group-active:text-red-500"
        aria-label={translations[Astro.currentLocale].read_more}
      >
        <span class="underline decoration-dashed decoration-from-font underline-offset-4">
          {translations[Astro.currentLocale].read_more}
        </span>
        <div
          class="font-mono text-sm font-light whitespace-nowrap select-none group-hover:translate-x-0.5 group-active:translate-x-0.5"
          aria-hidden="true"
        >
          ->
        </div>
      </div>
    </footer>
  </article>
</a>
